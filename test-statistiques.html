<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test des Statistiques - Panel Admin</title>
    
    <!-- Scripts -->
    <script src="../assets/js/admin-config.js"></script>
    <script src="../assets/js/admin-stats.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f8fafc;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 15px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #60a5fa;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #94a3b8;
            margin-bottom: 10px;
        }
        
        .stat-trend {
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }
        
        .trend-up {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }
        
        .trend-down {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }
        
        .trend-stable {
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        
        .btn.success { background: linear-gradient(135deg, #10b981, #059669); }
        .btn.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .btn.danger { background: linear-gradient(135deg, #ef4444, #dc2626); }
        
        .status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(51, 65, 85, 0.3);
        }
        
        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .info-box h3 {
            color: #60a5fa;
            margin-top: 0;
        }
        
        .info-box ul {
            text-align: left;
            margin: 10px 0;
        }
        
        .info-box li {
            margin: 5px 0;
        }
        
        .alerts-section {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .alert-item {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            color: #fca5a5;
        }
        
        .alert-item.warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.3);
            color: #fcd34d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Test des Statistiques - Panel Admin</h1>
            <p>V√©rification que toutes les statistiques g√©n√©rales fonctionnent correctement</p>
        </div>
        
        <div class="info-box">
            <h3>üìä Syst√®me de Statistiques</h3>
            <ul>
                <li><strong>AdminStatsManager:</strong> G√®re toutes les m√©triques en temps r√©el</li>
                <li><strong>Simulation r√©aliste:</strong> Donn√©es qui changent progressivement</li>
                <li><strong>Compatibilit√©:</strong> Cr√©e les moniteurs manquants (siteMonitor, performanceMonitor, activityMonitor)</li>
                <li><strong>Mise √† jour:</strong> Toutes les 3 secondes automatiquement</li>
            </ul>
        </div>
        
        <div class="status">
            <h3>üìä Statut des Statistiques</h3>
            <p id="statusText">En attente d'initialisation...</p>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="startStats()">üöÄ D√©marrer Statistiques</button>
            <button class="btn success" onclick="updateStats()">üìä Mettre √† Jour</button>
            <button class="btn warning" onclick="restartStats()">üîÑ Red√©marrer</button>
            <button class="btn danger" onclick="stopStats()">‚èπÔ∏è Arr√™ter</button>
        </div>
        
        <!-- Statistiques Principales -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Visiteurs</div>
                <div class="stat-value" id="visitorsCount">0</div>
                <div class="stat-trend trend-up" id="visitorsTrend">+0%</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Vues de Page</div>
                <div class="stat-value" id="pageViewsCount">0</div>
                <div class="stat-trend trend-up" id="pageViewsTrend">+0%</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Temps de Fonctionnement</div>
                <div class="stat-value" id="uptimeValue">00:00:00</div>
                <div class="stat-trend trend-stable">Stable</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Utilisation M√©moire</div>
                <div class="stat-value" id="memoryUsage">0 MB (0%)</div>
                <div class="stat-trend trend-stable" id="memoryTrend">Stable</div>
            </div>
        </div>
        
        <!-- Statistiques Secondaires -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Score Performance</div>
                <div class="stat-value" id="performanceScore">0</div>
                <div class="stat-trend trend-stable" id="performanceTrend">Stable</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Erreurs</div>
                <div class="stat-value" id="errorsCount">0</div>
                <div class="stat-trend trend-stable" id="errorsTrend">Syst√®me stable</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">FPS</div>
                <div class="stat-value" id="fpsValue">0</div>
                <div class="stat-trend trend-stable" id="fpsTrend">Fluide</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Qualit√© Animations</div>
                <div class="stat-value" id="animationQuality">0%</div>
                <div class="stat-trend trend-stable" id="animationTrend">Fluide</div>
            </div>
        </div>
        
        <!-- Alertes -->
        <div class="alerts-section">
            <h3>üö® Alertes Actives</h3>
            <div id="alertsContainer">
                <p>Aucune alerte active</p>
            </div>
        </div>
    </div>

    <script>
        let statsManager = null;
        let updateInterval = null;
        
        // D√©marrer les statistiques
        function startStats() {
            try {
                if (window.adminStatsManager) {
                    statsManager = window.adminStatsManager;
                    updateStatus('‚úÖ Statistiques d√©marr√©es avec succ√®s');
                    
                    // D√©marrer la mise √† jour automatique de l'affichage
                    startAutoDisplayUpdate();
                    
                } else {
                    updateStatus('‚ùå AdminStatsManager non disponible');
                }
            } catch (error) {
                updateStatus('‚ùå Erreur d√©marrage: ' + error.message);
            }
        }
        
        // Mettre √† jour manuellement
        function updateStats() {
            if (statsManager) {
                const stats = statsManager.getStats();
                updateDisplay(stats);
                updateStatus('üìä Statistiques mises √† jour manuellement');
            } else {
                updateStatus('‚ùå Statistiques non d√©marr√©es');
            }
        }
        
        // Red√©marrer les statistiques
        function restartStats() {
            if (statsManager) {
                statsManager.restart();
                updateStatus('üîÑ Statistiques red√©marr√©es');
            } else {
                updateStatus('‚ùå Statistiques non d√©marr√©es');
            }
        }
        
        // Arr√™ter les statistiques
        function stopStats() {
            if (statsManager) {
                statsManager.stop();
                updateStatus('‚èπÔ∏è Statistiques arr√™t√©es');
                
                if (updateInterval) {
                    clearInterval(updateInterval);
                    updateInterval = null;
                }
            } else {
                updateStatus('‚ùå Statistiques non d√©marr√©es');
            }
        }
        
        // D√©marrer la mise √† jour automatique de l'affichage
        function startAutoDisplayUpdate() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            updateInterval = setInterval(() => {
                if (statsManager) {
                    const stats = statsManager.getStats();
                    updateDisplay(stats);
                }
            }, 1000); // Mise √† jour toutes les secondes
            
            updateStatus('üîÑ Mise √† jour automatique d√©marr√©e (1s)');
        }
        
        // Mettre √† jour l'affichage
        function updateDisplay(stats) {
            // Statistiques principales
            updateElement('visitorsCount', stats.visitors || 0);
            updateElement('pageViewsCount', stats.pageViews || 0);
            updateElement('uptimeValue', stats.uptime || '00:00:00');
            updateElement('memoryUsage', `${stats.memory?.used || '0 MB'} (${stats.memory?.percentage || 0}%)`);
            
            // Statistiques secondaires
            updateElement('performanceScore', Math.round(stats.performanceScore || 0));
            updateElement('errorsCount', stats.errors || 0);
            updateElement('fpsValue', Math.round(stats.fps || 0));
            updateElement('animationQuality', Math.round((stats.animationQuality || 0) * 100) + '%');
            
            // Tendances
            updateTrend('visitorsTrend', stats.trends?.visitors || '+0%');
            updateTrend('pageViewsTrend', stats.trends?.pageViews || '+0%');
            updateTrend('memoryTrend', stats.trends?.memory || 'Stable');
            updateTrend('performanceTrend', stats.trends?.performance || 'Stable');
            updateTrend('fpsTrend', stats.trends?.fps || 'Fluide');
            updateTrend('animationTrend', stats.trends?.animation || 'Fluide');
            
            // Alertes
            updateAlerts(stats.alerts || []);
        }
        
        // Mettre √† jour un √©l√©ment
        function updateElement(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
            }
        }
        
        // Mettre √† jour une tendance
        function updateTrend(elementId, trend) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = trend;
                
                // Appliquer la classe de couleur appropri√©e
                element.className = 'stat-trend';
                if (trend.includes('+') || trend.includes('Fluide') || trend.includes('Stable')) {
                    element.classList.add('trend-up');
                } else if (trend.includes('-') || trend.includes('Faible') || trend.includes('√âlev√©e')) {
                    element.classList.add('trend-down');
                } else {
                    element.classList.add('trend-stable');
                }
            }
        }
        
        // Mettre √† jour les alertes
        function updateAlerts(alerts) {
            const container = document.getElementById('alertsContainer');
            if (!container) return;
            
            if (alerts.length === 0) {
                container.innerHTML = '<p>Aucune alerte active</p>';
                return;
            }
            
            container.innerHTML = alerts.map(alert => `
                <div class="alert-item ${alert.type}">
                    <strong>${alert.type.toUpperCase()}:</strong> ${alert.message}
                    <br><small>${new Date(alert.timestamp).toLocaleTimeString()}</small>
                </div>
            `).join('');
        }
        
        // Mettre √† jour le statut
        function updateStatus(message) {
            const statusText = document.getElementById('statusText');
            statusText.textContent = message;
            console.log(message);
        }
        
        // Initialisation automatique
        window.addEventListener('load', () => {
            updateStatus('üöÄ Page charg√©e - V√©rification des composants');
            
            // V√©rifier que AdminStatsManager est disponible
            if (window.AdminStatsManager) {
                updateStatus('‚úÖ AdminStatsManager disponible');
            } else {
                updateStatus('‚ùå AdminStatsManager non disponible');
            }
            
            // V√©rifier que les moniteurs de compatibilit√© sont cr√©√©s
            if (window.siteMonitor && window.performanceMonitor && window.activityMonitor) {
                updateStatus('‚úÖ Moniteurs de compatibilit√© cr√©√©s');
            } else {
                updateStatus('‚ùå Moniteurs de compatibilit√© manquants');
            }
            
            // D√©marrer automatiquement apr√®s 2 secondes
            setTimeout(() => {
                startStats();
            }, 2000);
        });
        
        // Exposer les fonctions globalement
        window.startStats = startStats;
        window.updateStats = updateStats;
        window.restartStats = restartStats;
        window.stopStats = stopStats;
    </script>
</body>
</html>
