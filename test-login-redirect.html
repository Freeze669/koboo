<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test Login & Redirection - MAYU & JACK STUDIO</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            padding: 2rem;
            line-height: 1.6;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        .test-button {
            background: #60a5fa;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 1rem;
        }
        .test-button:hover {
            background: #3b82f6;
        }
        .status {
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
        }
        .status.success { background: rgba(16, 185, 129, 0.2); border: 1px solid #10b981; }
        .status.error { background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; }
        .status.warning { background: rgba(251, 191, 36, 0.2); border: 1px solid #fbbf24; }
        .log {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Login & Redirection</h1>
    
    <div class="test-section">
        <h2>üìã Tests de Configuration</h2>
        <button class="test-button" onclick="testConfig()">Tester la Configuration</button>
        <button class="test-button" onclick="testAdminUtils()">Tester AdminUtils</button>
        <button class="test-button" onclick="testAdminPanelAccess()">Tester Acc√®s Panel</button>
        <div id="configStatus"></div>
    </div>

    <div class="test-section">
        <h2>üîê Test de Connexion</h2>
        <input type="text" id="testCode" placeholder="Code admin (DF505)" value="DF505" style="padding: 0.5rem; margin: 0.5rem; border-radius: 5px; border: 1px solid #ccc; color: #000;">
        <button class="test-button" onclick="testLogin()">Tester Connexion</button>
        <div id="loginStatus"></div>
    </div>

    <div class="test-section">
        <h2>üöÄ Test de Redirection</h2>
        <button class="test-button" onclick="testRedirect()">Tester Redirection</button>
        <button class="test-button" onclick="testRedirectFallback()">Tester Redirection Fallback</button>
        <div id="redirectStatus"></div>
    </div>

    <div class="test-section">
        <h2>üìä Logs de Test</h2>
        <button class="test-button" onclick="clearLogs()">Effacer Logs</button>
        <div id="testLogs" class="log"></div>
    </div>

    <script src="admin-config.js"></script>
    <script>
        let testLogs = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testLogs.push(logEntry);
            
            const logsDiv = document.getElementById('testLogs');
            logsDiv.innerHTML = testLogs.join('<br>');
            logsDiv.scrollTop = logsDiv.scrollHeight;
            
            console.log(logEntry);
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function testConfig() {
            log('üß™ Test de configuration...');
            
            try {
                if (typeof ADMIN_CONFIG === 'undefined') {
                    showStatus('configStatus', '‚ùå ADMIN_CONFIG non d√©fini', 'error');
                    return;
                }
                
                if (!ADMIN_CONFIG.security || !ADMIN_CONFIG.security.adminCode) {
                    showStatus('configStatus', '‚ùå Configuration de s√©curit√© invalide', 'error');
                    return;
                }
                
                showStatus('configStatus', `‚úÖ Configuration OK - Code admin: ${ADMIN_CONFIG.security.adminCode}`, 'success');
                log(`‚úÖ Configuration charg√©e: ${ADMIN_CONFIG.security.adminCode}`);
                
            } catch (error) {
                showStatus('configStatus', `‚ùå Erreur configuration: ${error.message}`, 'error');
                log(`‚ùå Erreur: ${error.message}`);
            }
        }

        function testAdminUtils() {
            log('üß™ Test AdminUtils...');
            
            try {
                if (typeof adminUtils === 'undefined') {
                    showStatus('configStatus', '‚ùå adminUtils non d√©fini', 'error');
                    return;
                }
                
                if (typeof adminUtils.validateAdminCode !== 'function') {
                    showStatus('configStatus', '‚ùå M√©thode validateAdminCode manquante', 'error');
                    return;
                }
                
                const testCode = 'DF505';
                const isValid = adminUtils.validateAdminCode(testCode);
                
                if (isValid) {
                    showStatus('configStatus', `‚úÖ AdminUtils OK - Validation: ${testCode}`, 'success');
                    log(`‚úÖ AdminUtils fonctionnel - Code ${testCode} valide`);
                } else {
                    showStatus('configStatus', `‚ùå Validation √©chou√©e pour ${testCode}`, 'error');
                    log(`‚ùå Validation √©chou√©e pour ${testCode}`);
                }
                
            } catch (error) {
                showStatus('configStatus', `‚ùå Erreur AdminUtils: ${error.message}`, 'error');
                log(`‚ùå Erreur: ${error.message}`);
            }
        }

        async function testAdminPanelAccess() {
            log('üß™ Test acc√®s panel admin...');
            
            try {
                const response = await fetch('admin-panel.html', { method: 'HEAD' });
                
                if (response.ok) {
                    showStatus('configStatus', '‚úÖ Panel admin accessible', 'success');
                    log('‚úÖ Panel admin accessible');
                } else {
                    showStatus('configStatus', `‚ùå Panel admin non accessible: ${response.status}`, 'error');
                    log(`‚ùå Panel admin non accessible: ${response.status}`);
                }
                
            } catch (error) {
                showStatus('configStatus', `‚ùå Erreur acc√®s panel: ${error.message}`, 'error');
                log(`‚ùå Erreur: ${error.message}`);
            }
        }

        function testLogin() {
            log('üß™ Test de connexion...');
            
            try {
                const testCode = document.getElementById('testCode').value;
                
                if (!adminUtils) {
                    showStatus('loginStatus', '‚ùå AdminUtils non disponible', 'error');
                    return;
                }
                
                const isValid = adminUtils.validateAdminCode(testCode);
                
                if (isValid) {
                    showStatus('loginStatus', `‚úÖ Connexion r√©ussie avec ${testCode}`, 'success');
                    log(`‚úÖ Connexion r√©ussie avec ${testCode}`);
                    
                    // Tester la cr√©ation de session
                    try {
                        const sessionToken = adminUtils.startSession();
                        log(`‚úÖ Session cr√©√©e: ${sessionToken}`);
                    } catch (sessionError) {
                        log(`‚ùå Erreur session: ${sessionError.message}`);
                    }
                    
                } else {
                    showStatus('loginStatus', `‚ùå Connexion √©chou√©e avec ${testCode}`, 'error');
                    log(`‚ùå Connexion √©chou√©e avec ${testCode}`);
                }
                
            } catch (error) {
                showStatus('loginStatus', `‚ùå Erreur test connexion: ${error.message}`, 'error');
                log(`‚ùå Erreur: ${error.message}`);
            }
        }

        function testRedirect() {
            log('üß™ Test redirection...');
            
            try {
                showStatus('redirectStatus', 'üöÄ Test de redirection vers admin-panel.html...', 'warning');
                
                setTimeout(() => {
                    try {
                        log('üìç Tentative de redirection...');
                        window.location.href = 'admin-panel.html';
                    } catch (error) {
                        log(`‚ùå Erreur redirection: ${error.message}`);
                        showStatus('redirectStatus', `‚ùå Erreur redirection: ${error.message}`, 'error');
                    }
                }, 2000);
                
            } catch (error) {
                showStatus('redirectStatus', `‚ùå Erreur test redirection: ${error.message}`, 'error');
                log(`‚ùå Erreur: ${error.message}`);
            }
        }

        function testRedirectFallback() {
            log('üß™ Test redirection fallback...');
            
            try {
                showStatus('redirectStatus', 'üöÄ Test redirection fallback...', 'warning');
                
                setTimeout(() => {
                    try {
                        log('üìç Tentative redirection fallback...');
                        window.location.replace('admin-panel.html');
                    } catch (error) {
                        log(`‚ùå Erreur redirection fallback: ${error.message}`);
                        showStatus('redirectStatus', `‚ùå Erreur fallback: ${error.message}`, 'error');
                    }
                }, 2000);
                
            } catch (error) {
                showStatus('redirectStatus', `‚ùå Erreur test fallback: ${error.message}`, 'error');
                log(`‚ùå Erreur: ${error.message}`);
            }
        }

        function clearLogs() {
            testLogs = [];
            document.getElementById('testLogs').innerHTML = '';
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Page de test charg√©e');
            log('üìã Pr√™t pour les tests');
            
            // Attendre un peu que AdminUtils soit initialis√©
            setTimeout(() => {
                if (typeof adminUtils !== 'undefined') {
                    log('‚úÖ AdminUtils disponible');
                } else {
                    log('‚ö†Ô∏è AdminUtils pas encore disponible');
                }
            }, 1000);
        });
    </script>
</body>
</html>
