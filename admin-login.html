<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Connexion Admin - MAYU & JACK STUDIO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="../assets/js/discord-logger.js"></script>
    <script src="../assets/js/member-tracker.js"></script>
    <script src="../assets/js/activity-monitor.js"></script>
    <script src="../assets/js/discord-logging-system.js"></script>
    <script src="../assets/js/admin-config.js"></script>
    <script src="../assets/js/admin-info-pages.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        /* Particules de fond */
        .login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .login-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(96, 165, 250, 0.6);
            border-radius: 50%;
            animation: loginParticleFloat 10s linear infinite;
        }

        @keyframes loginParticleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .login-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 3rem;
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 10;
        }

        .login-header {
            margin-bottom: 2rem;
        }

        .login-logo {
            font-size: 3rem;
            color: #fbbf24;
            margin-bottom: 1rem;
            animation: logoGlow 2s ease-in-out infinite alternate;
        }

        @keyframes logoGlow {
            from { text-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
            to { text-shadow: 0 0 30px rgba(251, 191, 36, 0.8); }
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.7;
            margin-bottom: 2rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            position: relative;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #60a5fa;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }

        .form-input:focus + .form-icon {
            color: #60a5fa;
        }

        .login-btn {
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(96, 165, 250, 0.4);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .login-btn .btn-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .login-btn .spinner {
            display: none;
            animation: spin 1s linear infinite;
        }

        .login-btn.loading .btn-content {
            display: none;
        }

        .login-btn.loading .spinner {
            display: block;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .login-footer {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .back-link {
            color: #60a5fa;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            color: #a78bfa;
            text-decoration: underline;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-message {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #6ee7b7;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .security-info {
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid rgba(96, 165, 250, 0.2);
            color: #93c5fd;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Animation d'entr√©e */
        .login-container {
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .login-container {
                margin: 1rem;
                padding: 2rem;
            }
            
            .login-title {
                font-size: 1.5rem;
            }
        }

        /* Effet de brillance sur le bouton */
        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .login-btn:hover::before {
            left: 100%;
        }

        .attempts-counter {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Particules de fond -->
    <div class="login-particles" id="loginParticles"></div>

    <!-- Container de connexion -->
    <div class="login-container">
        <div class="login-header">
            <div class="login-logo">
                <i class="fas fa-crown"></i>
            </div>
            <h1 class="login-title">Administration</h1>
            <p class="login-subtitle">Acc√©dez √† votre panel d'administration s√©curis√©</p>
        </div>

        <!-- Informations de s√©curit√© -->
        <div class="security-info">
            <i class="fas fa-shield-alt"></i>
            <span>Connexion s√©curis√©e - Code d'acc√®s requis</span>
        </div>

        <!-- Messages d'erreur/succ√®s -->
        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <!-- Formulaire de connexion -->
        <form class="login-form" id="loginForm">
            <div class="form-group">
                <input type="text" class="form-input" id="adminCode" placeholder="Code d'acc√®s administrateur" required>
                <i class="fas fa-key form-icon"></i>
                <div class="attempts-counter" id="attemptsCounter"></div>
            </div>
            
            <button type="submit" class="login-btn" id="loginBtn">
                <div class="btn-content">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Se connecter</span>
                </div>
                <div class="spinner">
                    <i class="fas fa-spinner"></i>
                </div>
            </button>
        </form>

        <div class="login-footer">
            <a href="../index.html" class="back-link">
                <i class="fas fa-arrow-left"></i>
                Retour au site principal
            </a>
        </div>
    </div>

    <script>
        // Variables globales
        let attempts = 0;
        let isLocked = false;
        let lockoutTimer = null;

        // Initialisation des particules
        function initLoginParticles() {
            const container = document.getElementById('loginParticles');
            if (!container) return;

            // Cr√©er 20 particules
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    createLoginParticle(container);
                }, i * 200);
            }

            // Cr√©er une nouvelle particule toutes les 3 secondes
            setInterval(() => {
                createLoginParticle(container);
            }, 3000);
        }

        function createLoginParticle(container) {
            const particle = document.createElement('div');
            particle.className = 'login-particle';
            
            // Position al√©atoire
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 10 + 's';
            particle.style.animationDuration = (Math.random() * 5 + 8) + 's';
            
            container.appendChild(particle);
            
            // Supprimer apr√®s l'animation
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 15000);
        }

        // Mise √† jour du compteur de tentatives
        function updateAttemptsCounter() {
            const counter = document.getElementById('attemptsCounter');
            const remaining = ADMIN_CONFIG.security.maxLoginAttempts - attempts;
            
            if (remaining > 0) {
                counter.textContent = `Tentatives restantes: ${remaining}`;
                counter.style.color = remaining <= 1 ? '#ef4444' : '#93c5fd';
            } else {
                counter.textContent = 'Compte temporairement bloqu√©';
                counter.style.color = '#ef4444';
            }
        }

        // V√©rification de la configuration
        function checkConfiguration() {
            if (typeof ADMIN_CONFIG === 'undefined') {
                console.error('‚ùå Configuration administrateur non trouv√©e');
                showNotification('‚ùå Erreur de configuration', 'error');
                return false;
            }
            
            if (typeof adminUtils === 'undefined') {
                console.error('‚ùå Utilitaires administrateur non trouv√©s');
                showNotification('‚ùå Erreur de configuration', 'error');
                return false;
            }
            
            return true;
        }

        // V√©rifier l'accessibilit√© du panel admin
        async function checkAdminPanelAccess() {
            try {
                const response = await fetch('./admin-panel.html', { method: 'HEAD' });
                if (response.ok) {
                    console.log('‚úÖ Panel admin accessible');
                    return true;
                } else {
                    console.error('‚ùå Panel admin non accessible:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Erreur lors de la v√©rification du panel admin:', error);
                return false;
            }
        }

        // Gestion du formulaire
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            console.log('üîê Tentative de connexion...');
            
            if (!checkConfiguration()) {
                console.error('‚ùå Configuration invalide');
                return;
            }
            
            const adminCode = document.getElementById('adminCode').value.trim();
            const loginBtn = document.getElementById('loginBtn');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');

            console.log('üîë Code saisi:', adminCode);
            console.log('üîë Code attendu:', ADMIN_CONFIG.security.adminCode);

            // Masquer les messages pr√©c√©dents
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';

            // V√©rifier si le compte est bloqu√©
            if (isLocked) {
                errorMessage.textContent = 'üö´ Compte temporairement bloqu√©. Veuillez patienter.';
                errorMessage.style.display = 'block';
                return;
            }

            // Valider l'entr√©e
            if (!adminUtils.validateInput(adminCode, 'code')) {
                errorMessage.textContent = '‚ùå Code d\'acc√®s invalide.';
                errorMessage.style.display = 'block';
                return;
            }

            // V√©rifier le code
            if (adminUtils.validateAdminCode(adminCode)) {
                console.log('‚úÖ Code valide, d√©marrage de la session...');
                
                // Connexion r√©ussie
                loginBtn.classList.add('loading');
                loginBtn.disabled = true;

                try {
                    // Logger la connexion
                    adminUtils.log('info', 'Connexion administrateur r√©ussie', {
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent
                    });

                    // D√©marrer la session
                    const sessionToken = adminUtils.startSession();
                    console.log('üîë Session d√©marr√©e avec token:', sessionToken);

                    // Simuler un d√©lai de connexion
                    await new Promise(resolve => setTimeout(resolve, 1500));

                    // Afficher le message de succ√®s
                    successMessage.textContent = '‚úÖ Connexion r√©ussie ! Redirection...';
                    successMessage.style.display = 'block';

                    console.log('üöÄ Redirection vers le panel admin...');

                    // Rediriger vers le panel admin
                    setTimeout(() => {
                        try {
                                            console.log('üìç Redirection vers admin-panel.html');
                window.location.href = './admin-panel.html';
                        } catch (redirectError) {
                            console.error('‚ùå Erreur de redirection:', redirectError);
                            // Fallback: essayer avec location.replace
                            try {
                                window.location.replace('./admin-panel.html');
                            } catch (fallbackError) {
                                console.error('‚ùå Erreur de redirection fallback:', fallbackError);
                                // Dernier recours: lien cliquable
                                successMessage.innerHTML = '‚úÖ Connexion r√©ussie ! <a href="./admin-panel.html" style="color: #10b981; text-decoration: underline;">Cliquez ici pour acc√©der au panel</a>';
                            }
                        }
                    }, 1000);

                } catch (sessionError) {
                    console.error('‚ùå Erreur lors de la cr√©ation de session:', sessionError);
                    errorMessage.textContent = '‚ùå Erreur lors de la connexion. Veuillez r√©essayer.';
                    errorMessage.style.display = 'block';
                    loginBtn.classList.remove('loading');
                    loginBtn.disabled = false;
                }

            } else {
                console.log('‚ùå Code incorrect');
                
                // Code incorrect
                attempts++;
                const remainingAttempts = ADMIN_CONFIG.security.maxLoginAttempts - attempts;

                // Logger la tentative √©chou√©e
                adminUtils.log('warn', 'Tentative de connexion √©chou√©e', {
                    attempts,
                    remainingAttempts,
                    timestamp: new Date().toISOString()
                });

                if (remainingAttempts > 0) {
                    errorMessage.textContent = `‚ùå Code incorrect. Il vous reste ${remainingAttempts} tentative(s).`;
                    errorMessage.style.display = 'block';
                } else {
                    // Bloquer le compte
                    isLocked = true;
                    errorMessage.textContent = 'üö´ Trop de tentatives √©chou√©es. Compte bloqu√© temporairement.';
                    errorMessage.style.display = 'block';
                    loginBtn.disabled = true;
                    
                    // Logger le blocage
                    adminUtils.log('error', 'Compte administrateur bloqu√©', {
                        reason: 'Trop de tentatives √©chou√©es',
                        timestamp: new Date().toISOString()
                    });
                    
                    // D√©bloquer apr√®s le d√©lai configur√©
                    lockoutTimer = setTimeout(() => {
                        isLocked = false;
                        attempts = 0;
                        loginBtn.disabled = false;
                        errorMessage.style.display = 'none';
                        updateAttemptsCounter();
                        
                        adminUtils.log('info', 'Compte administrateur d√©bloqu√©', {
                            timestamp: new Date().toISOString()
                        });
                    }, ADMIN_CONFIG.security.lockoutDuration);
                }

                // Mettre √† jour le compteur
                updateAttemptsCounter();

                // Effacer le champ
                document.getElementById('adminCode').value = '';
                document.getElementById('adminCode').focus();
            }
        });

        // Raccourcis clavier
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !isLocked) {
                document.getElementById('loginForm').dispatchEvent(new Event('submit'));
            }
            if (e.key === 'Escape') {
                window.location.href = '../index.html';
            }
        });

        // Focus automatique sur le champ de code
        document.getElementById('adminCode').focus();

        // Initialisation au chargement
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîê Page de connexion admin charg√©e');
            
            // V√©rifier la configuration
            if (!checkConfiguration()) return;
            
            // V√©rifier l'accessibilit√© du panel admin
            checkAdminPanelAccess().then(isAccessible => {
                if (!isAccessible) {
                    console.warn('‚ö†Ô∏è Panel admin non accessible, redirection impossible');
                    const errorMessage = document.getElementById('errorMessage');
                    errorMessage.textContent = '‚ö†Ô∏è Panel admin non accessible. V√©rifiez que admin-panel.html existe dans le dossier admin.';
                    errorMessage.style.display = 'block';
                }
            });
            
            // Initialiser les particules
            initLoginParticles();
            
            // Initialiser le compteur de tentatives
            updateAttemptsCounter();
            
            // Message de bienvenue
            setTimeout(() => {
                console.log('üéØ Code d\'acc√®s requis pour l\'administration');
                adminUtils.log('info', 'Page de connexion admin initialis√©e', {
                    timestamp: new Date().toISOString()
                });
            }, 1000);
        });

        // Effet de frappe sur le champ de code
        document.getElementById('adminCode').addEventListener('input', function(e) {
            const input = e.target;
            if (input.value.length > 0) {
                input.style.borderColor = '#60a5fa';
                input.style.boxShadow = '0 0 20px rgba(96, 165, 250, 0.3)';
            } else {
                input.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                input.style.boxShadow = 'none';
            }
        });

        // Nettoyage au d√©chargement de la page
        window.addEventListener('beforeunload', function() {
            if (lockoutTimer) {
                clearTimeout(lockoutTimer);
            }
        });

        console.log(`
        üîê ADMIN LOGIN - MAYU & JACK STUDIO
        ===================================
        
        üéØ Syst√®me de connexion s√©curis√©:
        ‚Ä¢ Code d'acc√®s requis: ${ADMIN_CONFIG.security.adminCode}
        ‚Ä¢ Limitation des tentatives: ${ADMIN_CONFIG.security.maxLoginAttempts} max
        ‚Ä¢ D√©lai de blocage: ${ADMIN_CONFIG.security.lockoutDuration / 1000}s
        ‚Ä¢ Dur√©e de session: ${ADMIN_CONFIG.security.sessionDuration / 60000} min
        
        üöÄ Interface moderne et responsive
        ‚Ä¢ Particules anim√©es en arri√®re-plan
        ‚Ä¢ Validation en temps r√©el
        ‚Ä¢ Logs de s√©curit√© complets
        
        ‚å®Ô∏è Raccourcis clavier:
        ‚Ä¢ Entr√©e: Valider la connexion
        ‚Ä¢ √âchap: Retour au site
        
        üîí Redirection automatique vers le panel admin
        apr√®s connexion r√©ussie
        `);
    </script>
</body>
</html>
